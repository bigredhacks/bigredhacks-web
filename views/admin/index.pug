//-
   Admin index page

extends _layout-admin

block append admin_content
    +contentHeading("Dashboard")

    +showMessages(messages)

    if !input
        - input = {}

    //- Nav tabs
    ul.nav.nav-tabs(role='tablist')
        li.active(role='presentation')
            a(href='#summary', aria-controls='summary', role='tab', data-toggle='tab') 📊 Summary + Stats
        li(role='presentation')
            a(href='#top-schools', aria-controls='top-schools', role='tab', data-toggle='tab') 🎓 Top Schools
        li(role='presentation')
            a(href='#announcements', aria-controls='announcements', role='tab', data-toggle='tab') 📣 Announcements
        li(role='presentation')
            a(href='#decisions', aria-controls='decisions', role='tab', data-toggle='tab') ✅ Decisions
        li(role='presentation')
            a(href='#rsvp-override', aria-controls='rsvp-override', role='tab', data-toggle='tab') 📅 RSVP Override
        //- li(role='presentation')
        //-     a(href='#mentors', aria-controls='mentors', role='tab', data-toggle='tab') Mentors

    //- Tab panes
    .tab-content
        #summary.tab-pane.active(role='tabpanel')
            .container-fluid
                .col-sm-6.col-lg-4
                    h2 Applicants
                    span #{applicants.total} 
                        span.bold total 
                        | applicants
                    ul
                        li 📝 #{applicants.pending} 
                            span.bold pending 
                            | review
                        li ✅ #{applicants.accepted} 
                            span.bold accepted
                        li ⏰ #{applicants.waitlisted} 
                            span.bold waitlisted
                        li 🚫 #{applicants.rejected} 
                            span.bold rejected 

                    h4 Cornell applicants
                    span #{applicantsCornell.total} 
                        span.bold total 
                        | Cornell applicants
                    ul
                        li 📝 #{applicantsCornell.pending} 
                            span.bold pending 
                            | review
                        li ✅ #{applicantsCornell.accepted} 
                            span.bold accepted
                        li ⏰ #{applicantsCornell.waitlisted} 
                            span.bold waitlisted
                        li 🚫 #{applicantsCornell.rejected} 
                            span.bold rejected 

                .col-sm-6.col-lg-4
                    h2 Attendees
                    span Out of #{applicants.accepted} 
                        span.bold accepted 
                        | applicants:
                        ul
                            li ✅ #{rsvps.true} 
                                span.bold confirmed 
                                | their invitations
                            li 🚫 #{rsvps.false} 
                                span.bold declined 
                                | their invitations
                            li ⏰ #{rsvps.null} have 
                                span.bold not responded

                    h4 Cornell Attendees 🌽 
                    span Out of #{applicantsCornell.accepted} 
                        span.bold accepted Cornell 
                        | applicants: 
                        ul
                            li ✅ #{rsvpsCornell.true} 
                                span.bold confirmed 
                                | their invitations
                            li 🚫 #{rsvpsCornell.false} 
                                span.bold declined 
                                | their invitations
                            li ⏰ #{rsvpsCornell.null} have 
                                span.bold not responded

                    h4 Attendee Gender Breakdown
                    ul
                        li ♂️ #{gender.male}% 
                            span.bold male
                        li ♀️ #{gender.female}% 
                            span.bold female
                        li #{gender.other}% 
                            span.bold other

                    h4 Attendee Age Breakdown
                    ul
                        li #{(ages.highSchool * 100 / rsvps.true).toFixed(1)}% 
                            span.bold high school 
                            | (#{ages.highSchool})
                        li #{(ages.freshman * 100 / rsvps.true).toFixed(1)}% 
                            span.bold freshmen 
                            | (#{ages.freshman})
                        li #{(ages.sophomore * 100 / rsvps.true).toFixed(1)}% 
                            span.bold sophomores 
                            | (#{ages.sophomore})
                        li #{(ages.junior * 100 / rsvps.true).toFixed(1)}% 
                            span.bold juniors 
                            | (#{ages.junior})
                        li #{(ages.senior * 100 / rsvps.true).toFixed(1)}% 
                            span.bold seniors 
                            | (#{ages.senior})
                        li #{(ages.graduateStudent * 100/ rsvps.true).toFixed(1)}% 
                            span.bold graduate students 
                            | (#{ages.graduateStudent})

                    h2 Reimbursements
                    span Our maximum reimbursement costs are:
                    ul
                        li 
                            span.bold RSVP'd: 
                            | $#{reimburse.currentMax}
                        li
                            span.bold All Accepted (including RSVP'd): 
                            | $#{reimburse.potentialMax}
                
                .col-sm-6.col-lg-4
                    h2 Logistics
                    span Dietary restrictions and shirt sizes collected for the #{rsvps.true} RSVP'd students we have:
                    
                    h4 Dietary Preferences 🍽
                    ul
                        li 🍖 
                            span.bold No restrictions
                            | : #{logistics.dietary.none}
                        li 🥦 
                            span.bold Vegetarian
                            | : #{logistics.dietary.vegetarian}
                        li 🍞 
                            span.bold Gluten-Free
                            | : #{logistics.dietary["gluten-free"]}
                    
                    h4 T-Shirt Sizes 👕
                    ul
                        li 
                            span.bold XS
                            | : #{logistics.tshirt.xs}
                        li 
                            span.bold S
                            | : #{logistics.tshirt.s}
                        li
                            span.bold M
                            | : #{logistics.tshirt.m}
                        li 
                            span.bold L
                            | : #{logistics.tshirt.l}
                        li 
                            span.bold XL
                            | : #{logistics.tshirt.xl}

                    h4 Hardware Requests 🔨
                    span #{logistics.hardware.total} 
                        span.bold total
                        |  requests
                    ul
                        li
                            span.bold VR
                            | : #{logistics.hardware.vr} requests
                        li
                            span.bold Smart Home
                            | : #{logistics.hardware.smartHome} requests
                        li
                            span.bold Robotics
                            | : #{logistics.hardware.robotics} requests
                        li
                            span.bold Wearables
                            | : #{logistics.hardware.wearables} requests
                        

        #top-schools.tab-pane(role='tabpanel')
            table.table.table-striped
                tr
                    th Rank
                    th School Name
                    th.text-center Applicants
                    th.text-center Going
                    th.text-center Not Going
                    th.text-center Accepted
                    th.text-center Waitlisted
                    th.text-center Rejected
                    th.text-center Pending
                for school, i in schools
                    - var done = (school.total == school.accepted + school.waitlisted + school.rejected);
                    tr
                        td(class=done ? "success": "")= i+1
                        td: h: a.low-vis(href="/admin/search?collegeid="+school.collegeid+"&college="+school.name,target="_blank") #{school.name}
                        td.text-center= school.total
                        td.text-center= school.going
                        td.text-center= school.notGoing
                        td.text-center= school.accepted
                        td.text-center= school.waitlisted
                        td.text-center= school.rejected
                        td.text-center= school.pending
        #announcements.tab-pane(role='tabpanel')
            form#announcement-form(method='post', action='/api/admin/announcements')
                h2 Make an Announcement
                p Post a new announcement to website, mobile, and social media.
                .form-group
                    label Announcement to post
                    input.form-control#announcementInput(type='text', name='message', placeholder='ex: Soylent is about to give a tech talk in Uris G01!', value = input.message || '', required=true)
                .form-group
                    label Channels to announce on
                    br
                    label
                        input#web(type='checkbox', name='web', value='true', checked=true)
                        | &nbsp;Live Page Web Notification 
                        span.fa.fa-globe
                    br
                    label
                        input#twitter(type='checkbox', name='twitter', value='true', checked=false)
                        | &nbsp;Twitter 
                        span.fa.fa-twitter
                    br
                    label
                        input#slack(type='checkbox', name='slack', value='true', checked=false)
                        | &nbsp;Slack 
                        span.fa.fa-slack
                .form-group
                    button#announcementMake.btn.btn-success(onclick="return confirm('Are you sure?')") Announce
        #decisions.tab-pane(role='tabpanel')
            .notify-decisions-section
                h2 Notify Decisions
                p Send an email notifying application decisions to all who have not received their latest decision.
                form#notify-form(method='post', action='/api/admin/rollingDecision')
                    .form-group.np-enabled
                        button#notifyMake.btn.btn-success(type='submit' onclick="return confirm('Are you sure? This will email new decisions!')") Make Rolling Decision
                br
                span Breakdown of decisions to be announced:
                br
                -
                    var totalAccept = 0;
                    var totalWaitlist = 0;
                    var totalReject = 0;

                table.table.table-striped
                    tr
                        th.text-center School Name
                        th.text-center Will Accept
                        th.text-center Will Waitlist
                        th.text-center Will Reject
                        th.text-center School Total
                    for school in decisionAnnounces
                        -
                            totalAccept = totalAccept + school.accepted;
                            totalWaitlist = totalWaitlist + school.waitlisted;
                            totalReject = totalReject + school.rejected;

                        tr
                            td: h: a.low-vis(href="/admin/search?collegeid=" + school.collegeid + "&college=" + school.name,target="_blank") #{school.name}
                            td.text-center= school.accepted
                            td.text-center= school.waitlisted
                            td.text-center= school.rejected
                            td.text-center= school.total
                    tr
                        td.text-center Total:
                        td.text-center=totalAccept
                        td.text-center=totalWaitlist
                        td.text-center=totalReject
                        td.text-center=totalAccept+totalWaitlist+totalReject


            .lottery-section
                h2 Run Lottery
                p Run a gender-balanced lottery for Cornell students.
                form#lottery-form(method='post', action='/api/admin/cornellLottery')
                    .form-group.np-enabled
                        input#lottery-amount(type='Number' name='numberToAccept' placeholder='amount to accept')
                        button#lottery-make.btn.btn-success(type='submit' onclick="return confirm('Are you sure?')") Run Lottery
            .waitlist-section
                h2 Accept off of Waitlist
                p Accept Cornell students off the waitlist based on application date.
                form#waitlist-form(method='post', action='/api/admin/cornellWaitlist')
                    .form-group.np-enabled
                        input#waitlist-amount(type='Number' name='numberToAccept' placeholder='amount to accept')
                        button#waitlist-make.btn.btn-success(type='submit' onclick="return confirm('Are you sure?')") Move Off Waitlist
        #rsvp-override.tab-pane(role='tabpanel')
            h2 Per-User RSVP Override
            form(method='POST', action='/api/admin/deadlineOverride')
                .form-group
                    label User's email
                    input.form-control(type='text', name='email', placeholder='ex. dinasauronion@yahoo.com',value='')
                    br
                    label New RSVP Time (in days)
                    input.form-control(type='text', name='daysToRSVP', placeholder='ex. 12 Days', value='')
                .form-group
                    button#rsvpOverride.btn.btn-success(type='submit') Override
        #mentors.tab-pane(role='tabpanel')
            table(class="table")
                thead
                    tr
                        td #[b Name]
                        td #[b Company]
                        td #[b Email]
                        td #[b Skills]
                tbody
                    each mentor in mentors
                        tr
                            td= mentor.name.first + " " + mentor.name.last
                            td= mentor.company
                            td= mentor.email
                            td= mentor.skills.join(", ")
